#!/usr/bin/env node

const { execSync } = require('node:child_process')

try {
  const events = execSync("khal list now 2d --format '{title} {start-time}'")
    .toString().trim()

  const nextEvent = events.split('Tomorrow')[0].split('\n').slice(1, -1)[0] || ''

  const payload = { text: nextEvent, tooltip: events }
  console.log(JSON.stringify(payload))
} catch (err) {
  execSync(`notify-send input 'Cannot run khal-script: ${err.message}'`)
}
