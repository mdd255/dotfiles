# zsh plugin auto completetion
bindkey "^M" autosuggest-execute
bindkey "^O" accept-line

# text-modifier keys
bindkey "^[k" backward-delete-word
bindkey "^[m" forward-delete-word

bindkey "^[b" backward-word
bindkey "^[q" kill-line

# disable ctrl+r
bindkey -r "^R"

# fzf custom keys
fd_path=".\
  $HOME/Projects\
  $HOME/.config\
  $HOME/Downloads
"

fd_extra_args="
  --hidden\
  --ignore-case
"

get_dir_path() {
  fd --type d $(echo $fd_extra_args) --max-depth 2 $(echo $fd_path) \
	| grep -v " " \
	| sed "s|$HOME/||g" \
	| fzf --no-preview --with-nth=-1 \
	| xargs
}

get_file_path() {
  fd --type f $(echo $fd_extra_args) $(echo $fd_path) \
	| grep -v " " \
	| fzf \
	| xargs
}

get_branch_name() {
	git branch -a \
	| sed 's#remotes/origin/##' \
	| sed 's/* //' \
	| fzf --no-preview \
	| xargs
}

get_commit_hash() {
	git log --oneline -n 500 \
	| sed 's/ /_/g' \
	| fzf --no-preview \
	| awk -F_ '{print $1}'
}

fzf_gbr() {
	local branch="$(get_branch_name)"
	[[ -n branch ]] && LBUFFER="git checkout ${branch}" && zle accept-line
}
zle -N fzf_gbr
bindkey "\eb" fzf_gbr

fzf-gcm() {
	local commit="$(get_commit_hash)"
}

# fzf cd
fzf_cd () {
  dir="$(get_dir_path)"

  if ((#dir > 0)); then
    LBUFFER="cd ~/${dir}" && zle accept-line
  fi
}
zle -N fzf_cd
bindkey "\e " fzf_cd

# fzf file picker
fzf_file_picker() { LBUFFER+="$(get_file_path)" }
zle -N fzf_file_picker
bindkey "\ef" fzf_file_picker

# fzf dir picker
fzf_dir_picker() { LBUFFER+="$(get_dir_path)" }
zle -N fzf_dir_picker
bindkey "\ed" fzf_dir_picker

# fzf commit picker
fzf_commit_picker() { LBUFFER+="$(get_commit_hash)" }
zle -N fzf_commit_picker
bindkey "\ea" fzf_commit_picker
